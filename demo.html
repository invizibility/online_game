<!DOCTYPE html> <!-- HTML 5 -->
<!-- All text on this page is property of Michael Sartin-Tarm. (c) 2013. -->
<!-- License pending.. -->
<html>
  <head>
    <meta charset="UTF-8"/>
    <title>WebGL Demo</title>
    <link rel='stylesheet' type="text/css" href="styles.css"/>
    <link rel='icon' type="image/x-icon" href="favicon.ico"/>

    <!-- hello -->
    <!-- Facebook API - See
         developers.facebook.com/docs/reference/plugins/like/

    <script async="async" id="facebook-jssdk" src="\
//connect.facebook.net/en_IN/all.js#xfbml=1&appId=497409006971163"></script>
    -->
    <!-- External JS libraries -->
    <script async="async" async="async" src="libs/gl-matrix.js"></script>
    <!-- Only used for RequestAnimFrame -->
    <script async="async" src="libs/webgl-utils.js"></script>

    <!-- Global constants and functions -->
    <script async="async" src="functions.js"></script>
    <script async="async" src="constants.js"></script>

    <!-- GL classes -->
    <script async="async" src="GLobject.js"></script>
    <script async="async" src="GLmatrix.js"></script>
    <script async="async" src="GLtexture.js"></script>
    <script async="async" src="GLframe.js"></script>
    <script async="async" src="GLshader.js"></script>
    <script async="async" src="GLcanvas.js"></script>
    <script async="async" src="GLstring.js"></script>
    <script async="async" src="GLaudio.js"></script>

    <!-- Simple objects -->
    <script async="async" src="Cylinder.js"></script>
    <script async="async" src="Sphere.js"></script>
    <script async="async" src="Torus.js"></script>
    <script async="async" src="Disk.js"></script>
    <script async="async" src="Quad.js"></script>

    <!-- Complex objects lv.1 -->
    <script async="async" src="Stool.js"></script>
    <script async="async" src="SixSidedPrism.js"></script>
    <script async="async" src="Ball.js"></script>
    <script async="async" src="ThickCyl.js"></script>
    <script async="async" src="Player.js"></script>

    <!-- Complex objects lv.2 -->
    <script async="async" src="StoolPyramid.js"></script>
    <script async="async" src="MazePiece.js"></script>
    <script async="async" src="Jumbotron.js"></script>

    <!-- Environments -->
    <script async="async" src="Skybox.js"></script>
    <script async="async" src="Cagebox.js"></script>
    <script async="async" src="Game.js"></script>
    <script async="async" src="GameConfig.js"></script>
    <script type="application/javascript">
    var the_scene = "";
    // cool font animation
    (function() {
      var i_count = 0;
      var inputz;
      var new_color = parseInt("890abc", 16);
      var limit = parseInt("ffffff", 16);
      var weak_color = parseInt("666666", 16);

      var cool_color = 238 * 256 * 256 + 135 * 256 + 187;

      var started = false;

      var check_start = function() {
        if (started === true) return true;
        if (the_scene.length > 0) {
          theCanvas.start(the_scene);
          started = true;
        }
        return started;
      };

      window.initGLcanvas = function() {
        if (!GLcanvas || !Game) {
          window.setTimeout(window.initGLcanvas, 50);
        } else if (!theCanvas){
          new GameConfig().setupDivs();
          theCanvas = new GLcanvas();
          theCanvas.init();
          window.setTimeout(window.initGLcanvas, 50);
          inputz = document.getElementsByClassName("beginner");
        } else if (!check_start()) {
            window.setTimeout(check_start,  50);
            window.setTimeout(check_start, 100);
            window.setTimeout(window.initGLcanvas, 150);

            var izz = inputz[(++i_count) % inputz.length];
            var new_thing = new_color.toString(16);
            // append leading 0's if needed
            for(var i=new_thing.length; i<6; ++i) new_thing = "0" + new_thing;
            izz.style.color = "#" + new_thing;

            // that should keep things interesting
            new_color = (1487 * (new_color % 557)) * 23 + Math.abs(new_color - cool_color) % limit;
            // color too bright, invert it
            if ((new_color % 256) + (new_color / 256 % 256) + (new_color / (256 * 256) % 256) > 240)
              new_color -= weak_color;
          }

      };
    } ());
    </script>
  </head>

  <body onload="window.initGLcanvas();">
    <div id='header'>
      <div class='one_third'>WebGL:</div>
      <div class='one_third'>A</div>
      <div class='one_third'>Demo</div>
    </div>

    <div class="wrap" id="wrap_all">
      <div id="banner">
	<div class="wrap">

	  <div id="display" style="padding-top:8px; width:100%;">
	    <input id="your_config" type="button"
		   class="floating stadium_input" value="You"/>
	    <!-- Toggled off when stadium loads -->
	    <div id="stadium_params" style="display:inline-block;">
	      <div style="float:left;font-size:16px;">Name:</div>
              <div style="float:right;width:55%;">
	        <input id="player_name" type="text"
		       class="floating stadium_input" value="Oname"/></div>
	      <br/>
	      <div style="float:left;font-size:16px;">Balls:</div>
	      <input id="stadium_balls" type="text" style="float:right; width:55%;"
		     value="20" class="floating stadium_input"/>
	    </div>

	  </div>
	</div>
	<p id="glcanvas_status">
	  <input id="stadium_balls" type="button" style="font-size:20px;" onclick="the_scene='game';" value="Play" class="floating stadium_input" />
        </p>

        <textarea id="error-log" rows="10" cols="10" style="position:relative;width:95%;font-size:10px;display:none;overflow:hidden;"></textarea>

	<canvas id="textureCanvas"></canvas>

      </div>

      <div class="main">
	<!--
	     We use a table with 2x2 cells,
	     lumping all the links into their own cells..
	  -->
        <div id="web_gl" style="display:inline-block;">WebGL</div>
        <div style="display:inline-block;"> And </div>
        <div id="web_audio" style="display:inline-block;">Web Audio</div>
        <div style="display:inline-block;">: A Demo </div>
	<table id="button_table" style="width:100%;">
	  <thead><tr>
	      <th><u>Shapes</u></th>
	      <th><u>Environments</u></th>
	  </tr></thead>
	  <tbody><tr>
	      <td>
		<input type="button"
		       onclick="the_scene='cylinder';"
		       value="Cylinder"
		       class="floating beginner"/>
		<input type="button"
		       onclick="the_scene='skybox';"
		       value="Skybox"
		       class="floating beginner"/>
		<input type="button"
		       onclick="the_scene='sphere';"
		       value="Sphere"
		       class="floating beginner"/>
		<input type="button"
		       onclick="the_scene='stool';"
		       value="Stool"
		       class="floating beginner"/>
		<input type="button"
		       onclick="the_scene='text';"
		       value="Text"
		       class="floating beginner"/>
		<input type="button"
		       onclick="the_scene='torus';"
		       value="Torus"
		       class="floating beginner"/>
	      </td>
	      <td>
		<input type="button"
		       onclick="the_scene='shadow';"
		       value="Shadows"
		       class="floating beginner"/>
		<input type="button"
		       onclick="the_scene='jumbotron';"
		       value="Jumbotron"
		       class="floating beginner"/>
		<input type="button"
		       value="Maze (disabled)"
		       class="floating beginner" style="color:#aa4455;font-size:22px;" disabled="disabled"/>
		<input type="button"
		       value="Stadium (disabled)"
		       class="floating beginner" style="color:#aa4455;font-size:22px;" disabled="disabled"/>
		<input type="button"
		       onclick="the_scene='game';"
		       value="Game"
		       class="floating beginner"/>
	      </td>
	  </tr></tbody>
	</table>
	<canvas id="glcanvas"></canvas>
      </div>
      <div id="land_down_under" style="clear:both;">
        <!-- It's bad code to not specify cols, but
             width in CSS lets browsers size it properly -->
        <textarea class="keyboard" rows="1"></textarea>
      </div>
    </div>


    <div id="footer">
      <input type="button"
	     value="(c) 2013 Batman and Robin"
	     class="floating" />
      <div class="title" id="title4" > </div>
    </div>
    <!-- Put this element one tag scope higher to hide it. -->
    <div class="shaders" id="shader1" style="display:none;">
      <textarea id="shader_frag_decls" rows="20">
	precision mediump float;

	uniform float ambient_coeff_u;
	uniform float frames_elapsed_u;
	uniform float hi_hat_u;
	uniform float wall_hit_u;
	uniform float diffuse_coeff_u;
	uniform float specular_coeff_u;
	uniform vec3 specular_color_u;

	varying vec3 distanceV;
	varying float diffuseV;
	varying float specularV;
	varying vec3 colorV;

	varying vec3 reflectionV;
	varying vec3 viewPosV;
	varying vec3 vModel;
	varying vec4 lModel;
	varying vec3 lightNorm;
	varying vec3 vertNorm;

	varying vec2 textureV;

	uniform sampler2D sampler0;
	uniform sampler2D sampler1;

	//Specular function
	float specular() {

	vec3 reflectionV2 = reflect(normalize(lightNorm), normalize(vertNorm));


	float specularV2 = dot(normalize(reflectionV2),
	normalize(vModel.xyz));
	if (specularV2 <= 0.) { specularV2 = 0.0; }
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  return specularV2;
			  }
			  </textarea>
      <textarea id="shader_decls" rows="20">
	precision mediump float;

	// Vector Attributes
	attribute vec3 vPosA;
	attribute vec3 vNormA;
	attribute vec3 vColA;
	attribute vec2 textureA;

	// Matrixes
	uniform mat4 pMatU; // Position
	uniform mat4 mvnMatU[3]; // Model, View, Normal
	uniform mat4 lMatU; // Lighting

	// Position attributes
	uniform vec3 lightPosU;
	uniform vec3 viewPosU;
	uniform float hi_hat_u;

	// Passed to the fragment shader
	varying vec3 distanceV;
	varying float diffuseV;
	varying vec3 colorV;
	varying vec2 textureV;

	varying vec3 viewPosV;
	varying vec3 vModel;
	varying vec4 lModel;
	varying vec3 lightNorm;
	varying vec3 vertNorm;
      </textarea>
      <textarea id="shader_frag_canvas" rows="20">

	void colorTexture(sampler2D theSampler) {

	float delta = 1.0 / 512.0;
	float sway = sin(frames_elapsed_u / 100.0) / 2.0;
	float sway2 = cos(frames_elapsed_u / 110.0) / 2.0;
	float the_beat = hi_hat_u;

	vec3 textureColor = texture2D(theSampler, textureV).xyz;

	vec3 textureColorz = texture2D(sampler1, vec2(textureV.s, textureV.t)).xyz;
	vec3 reflectionV2 = reflect(normalize(lightNorm), normalize(normalize(vertNorm) +
          normalize(vec3(textureColorz.x, textureColorz.y, textureColorz.z))));
	float diffuseV2 = dot(vertNorm, normalize(lightNorm));

	float specularV2 = dot(normalize(reflectionV2),
        normalize(vModel.xyz));
	if (specularV2 <= 0.0) { specularV2 = 0.0; }
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;

			  vec3 ambColor = textureColor / 3.0;
			  vec3 diffColor = textureColor * diffuseV2 * 0.6;
			  vec3 specColor = textureColor * specularV2;

			  vec3 blendColor = mod(distanceV, 50.0) / 50.0;
			  vec3 normalColor = ambColor + diffColor + specColor;
			  vec3 changedColor = ambColor + diffColor + specColor;

			  changedColor[0] *= sway;
			  changedColor[1] *= -sway2;
			  changedColor[2] *= abs((sway * sway2));

			  float background = clamp(length(changedColor) * 5.0, 0.8, 1.0);

			  vec3 actual_color = changedColor * 1.6;
			  float yellow =  dot(max(vec2(actual_color.r, actual_color.g),0.0), vec2(0.75, 0.75));

			  changedColor = vec3(yellow, yellow, actual_color.b / (yellow + 0.01));


			  gl_FragColor = vec4((changedColor + 2.0 * normalize(changedColor)) / 3.0, background);
			  }

			  void main(void) {
			  colorTexture(sampler0);
			  }
			  </textarea>
      <textarea id="shader_frag_player" rows="20">
	void colorTexture(sampler2D theSampler) {

	float delta = 1.0 / 512.0;
	float sway = sin((frames_elapsed_u + 60.0) / 100.0) / 2.0;
	float sway2 = cos((frames_elapsed_u + 60.0) / 110.0) / 2.0;
	float the_beat = hi_hat_u;

	vec3 textureColor = texture2D(theSampler, textureV).xyz;
	textureColor[0] *= 4.0 * sway;
	textureColor[1] *= -4.0 * sway2;
	textureColor[2] *= abs((sway * sway2));

	float background = clamp(length(textureColor) * 5.0, 0.8, 1.0);

	gl_FragColor = vec4(textureColor * 1.6, 1.0);
	/*	if(background < 0.95 && the_beat > 0.9) gl_FragColor =
	  (20. - the_beat) / 20. * vec4(textureColor * 1.6, background) +
	  the_beat / 20. * texture2D(theSampler, textureV);
	  */	  }

	  void main(void) { colorTexture(sampler1);

	  }
      </textarea>
      <textarea id="shader_frag_default">
	void colorize() {
	vec3 ambColor = colorV / 3.0 * ambient_coeff_u;
	vec3 diffColor = colorV / 3.0 * diffuseV * diffuse_coeff_u;
	vec3 specColor = specular_color_u * specular();
	gl_FragColor = vec4(ambColor + diffColor + specColor, 1.0);
	}

	void colorTexture(sampler2D theSampler) {
	vec3 textureColor = texture2D(theSampler, vec2(textureV.s, textureV.t)).xyz;


	vec3 textureColorz = texture2D(sampler1, vec2(textureV.s, textureV.t)).xyz;
	vec3 reflectionV2 = reflect(normalize(lightNorm), normalize(
          normalize(vertNorm) + normalize(vec3(-textureColorz.x, -textureColorz.y, -textureColorz.z))));
	float diffuseV2 = dot(vertNorm, normalize(lightNorm));

	float specularV2 = dot(normalize(reflectionV2),
        normalize(vModel.xyz));
	if (specularV2 <= 0.0) { specularV2 = 0.0; }
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;

			  vec3 ambColor = textureColor / 3.0 * ambient_coeff_u;
			  vec3 diffColor = textureColor * diffuseV2 * 0.7;
			  vec3 specColor = textureColor * specularV2;
			  vec3 blendColor = mod(distanceV, 50.0) / 50.0;
			  vec3 normalColor = ambColor + diffColor + specColor;

			  float wall_hit_coeff = wall_hit_u / 40.0;
			  gl_FragColor = vec4(normalColor + ((ambColor + normalColor) *
			  wall_hit_coeff), 1.0);
			  }


			  void main(void) {
			  //  if(dot(normalize(vertNorm), vec3(0.0, 0.0,-1.0)) < 0.0) {
										 //    discard;
										 colorTexture(sampler0);
										 }
										 </textarea>
      <textarea id="shader_vert_default" rows="20">
	void main(void) {
	// -- Position -- //
	gl_Position = pMatU * mvnMatU[1] * mvnMatU[0] * vec4(vPosA, 1.0);

	// Viewing space coordinates of light / vertex
	vModel = (mvnMatU[1] * mvnMatU[0]  * vec4(vPosA, 1.0)).xyz;
	lModel = mvnMatU[1] * mvnMatU[0] * vec4(lightPosU, 1.0);


	// -- Lighting -- //
	distanceV = lModel.xyz - vModel.xyz;
	lightNorm = normalize(distanceV);
	vertNorm = (mvnMatU[2] * vec4(vNormA,1.0)).xyz;

	// Ambient components we'll leave until frag shader
	colorV = vColA;
	textureV = textureA;
	// Diffuse component
	diffuseV = dot(vertNorm, lightNorm);
	if (diffuseV < 0.0) { diffuseV = 0.0; }

		       }
		       </textarea>
      <textarea id="shader_vert_player" rows="20">
	void main(void) {

	// -- Position -- //
	gl_Position = pMatU * mvnMatU[1] * mvnMatU[0] * vec4(vPosA * (1.0 + (hi_hat_u / 110.0)), 1.0);
	//  gl_Position = pMatU * mvnMatU[1] * mvnMatU[0] * vec4(vPosA, 1.0);

	// Viewing space coordinates of light / vertex
	vModel = (mvnMatU[1] * mvnMatU[0]  * vec4(vPosA, 1.0)).xyz;
	lModel = mvnMatU[1] * lMatU * mvnMatU[0] * vec4(lightPosU, 1.0);


	// -- Lighting -- //
	distanceV = vModel.xyz - lModel.xyz;
	lightNorm = normalize(distanceV);
	vertNorm = (mvnMatU[2] * vec4(vNormA,1.0)).xyz;

	// Ambient components we'll leave until frag shader
	colorV = vColA;
	textureV = textureA;
	// Diffuse component
	diffuseV = dot(vertNorm, lightNorm);
	if (diffuseV < 0.0) { diffuseV = 0.0; }
		       }
		       </textarea>
    </div>
    <div id="fb-root"></div>
<!--    <div class="fb-like" data-href="http://msartintarm.github.io/online_game/demo.html" data-width="450" data-show-faces="true" data-send="false" colorscheme="dark"></div>-->
  </body>
</html>
