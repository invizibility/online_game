<!DOCTYPE html> <!-- HTML 5 -->
<!-- All text on this page is property of Michael Sartin-Tarm. (c) 2013. -->
<!-- License pending. -->
<html>
  <head>
    <meta charset="UTF-8"/>
    <title>WebGL Demo</title>
    <link rel='stylesheet' type="text/css" href="styles.css"/>
    <link rel='icon' type="image/x-icon" href="favicon.ico"/>

    <!-- hello ->

    <!-- External JS libraries -->
    <script src="libs/gl-matrix.js" type="application/javascript" async="async"></script>
    <!-- Only used for RequestAnimFrame -->
    <script src="libs/webgl-utils.js" type="application/javascript" async="async"></script>

    <!-- Global constants and functions -->
    <script src="functions.js" type="application/javascript"></script>
    <script src="constants.js" type="application/javascript" async="async"></script>

    <!-- GL classes -->
    <script src="GLobject.js" type="application/javascript" async="async"></script>
    <script src="GLmatrix.js" type="application/javascript" async="async"></script>
    <script src="GLtexture.js" type="application/javascript" async="async"></script>
    <script src="GLframe.js" type="application/javascript" async="async"></script>
    <script src="GLshader.js" type="application/javascript" async="async"></script>
    <script src="GLcanvas.js" type="application/javascript" async="async"></script>
    <script src="GLstring.js" type="application/javascript" async="async"></script>
    <script src="GLaudio.js" type="application/javascript" async="async"></script>

    <!-- Simple objects -->
    <script src="Cylinder.js" type="application/javascript" async="async"></script>
    <script src="Sphere.js" type="application/javascript" async="async"></script>
    <script src="Torus.js" type="application/javascript" async="async"></script>
    <script src="Disk.js" type="application/javascript" async="async"></script>
    <script src="Quad.js" type="application/javascript" async="async"></script>

    <!-- Complex objects lv.1 -->
    <script src="Stool.js" type="application/javascript" async="async"></script>
    <script src="SixSidedPrism.js" type="application/javascript" async="async"></script>
    <script src="Ball.js" type="application/javascript" async="async"></script>
    <script src="ThickCyl.js" type="application/javascript" async="async"></script>
    <script src="Player.js" type="application/javascript" async="async"></script>

    <!-- Complex objects lv.2 -->
    <script src="StoolPyramid.js" type="application/javascript" async="async"></script>
    <script src="MazePiece.js" type="application/javascript" async="async"></script>
    <script src="Jumbotron.js" type="application/javascript" async="async"></script>

    <!-- Environments -->
    <script src="Skybox.js" type="application/javascript" async="async"></script>
    <script src="Cagebox.js" type="application/javascript" async="async"></script>
    <script src="Game.js" type="application/javascript" async="async"></script>
    <script src="GameConfig.js" type="application/javascript" async="async"></script>
  </head>

  <body>
    <div id='header'>
      <div class='one_third'>WebGL:</div>
      <div class='one_third'>A</div>
      <div class='one_third'>Demo</div>
    </div>

    <div class="wrap" id="wrap_all">
      <div id="banner">
	<div class="wrap">

	  <div id="display" style="padding-top:8px; width:100%;">
	    <p id="glcanvas_status"></p>

	    <!-- Toggled off when stadium loads -->
	    <div id="stadium_params" style="display:inline-block;">
	      <div style="float:left;">Name:</div>
	      <input id="player_name" type="text" style="float:right; width:60%;"
		     class="start_button stadium_input" value="Oname"/>
	      <br/>
	      <div style="float:left;">Balls:</div>
	      <input id="stadium_balls" type="text" style="float:right; width:60%;"
		     value="20" class="start_button stadium_input"/>
	      <input id="stadium_balls" type="button" style="float:left;"
		     value="Play" class="start_button stadium_input" />
	    </div>

	    <!-- Toggled on when stadium loads -->

	  </div>
	</div>

	<canvas id="textureCanvas" style="float:left;display:none;">
	  I'm sorry your browser does not support the HTML5 canvas element.
	</canvas>

      </div>

      <div id="keyboard" style="position:absolute; bottom: 0px; left: 0px; color: #ffffff;"></div>
      <div class='main'>
	<canvas id="glcanvas" width="1100"></canvas>
	<!--
	     We use a table with 2x2 cells,
	     lumping all the links into their own cells..
	  -->
	<table id="button_table" style="width:100%;">
	  <thead><tr></tr><tr>
	      <th><u>Shapes</u></th>
	      <th><u>Environments</u></th>
	  </tr></thead>
	  <tbody><tr>
	      <td>
		<input type="button"
		       onclick="theCanvas.start('cylinder');"
		       value="Cylinder"
		       class="start_button"/>
		<input type="button"
		       onclick="theCanvas.start('skybox');"
		       value="Skybox"
		       class="start_button"/>
		<input type="button"
		       onclick="theCanvas.start('sphere');"
		       value="Sphere"
		       class="start_button"/>
		<input type="button"
		       onclick="theCanvas.start('stool');"
		       value="Stool"
		       class="start_button"/>
		<input type="button"
		       onclick="theCanvas.start('text');"
		       value="Text"
		       class="start_button"/>
		<input type="button"
		       onclick="theCanvas.start('torus');"
		       value="Torus"
		       class="start_button"/>
	      </td>
	      <td>
		<input type="button"
		       onclick="theCanvas.start('shadow');"
		       value="Shadows"
		       class="start_button"/>
		<input type="button"
		       onclick="theCanvas.start('jumbotron');"
		       value="Jumbotron"
		       class="start_button"/>
		<input type="button"
		       value="Maze (disabled)"
		       class="start_button" style="color:#aa4455;font-size:22px;" disabled="disabled"/>
		<input type="button"
		       value="Stadium (disabled)"
		       class="start_button" style="color:#aa4455;font-size:22px;" disabled="disabled"/>
		<input type="button"
		       onclick="theCanvas.start('game');"
		       value="Game"
		       class="start_button"/>
	      </td>
	  </tr></tbody>
	</table>
      </div>
      <div style="clear:both;"></div>
    </div>


    <div id="footer">
      <input type="button"
	     value="(c) 2013 Batman and Robin"
	     class="start_button" />
      <div class="title" id="title4" > </div>
    </div>
    <!-- Put this element one tag scope higher to hide it. -->
    <div class="shaders" id="shader1" style="display:none;">
      <textarea id="shader_frag_decls" rows="20">
	precision mediump float;

	uniform float ambient_coeff_u;
	uniform float frames_elapsed_u;
	uniform float hi_hat_u;
	uniform float wall_hit_u;
	uniform float diffuse_coeff_u;
	uniform float specular_coeff_u;
	uniform vec3 specular_color_u;

	varying vec3 distanceV;
	varying float diffuseV;
	varying float specularV;
	varying vec3 colorV;

	varying vec3 reflectionV;
	varying vec3 viewPosV;
	varying vec3 vModel;
	varying vec4 lModel;
	varying vec3 lightNorm;
	varying vec3 vertNorm;

	varying vec2 textureV;

	uniform sampler2D sampler0;
	uniform sampler2D sampler1;

	//Specular function
	float specular() {

	vec3 reflectionV2 = reflect(normalize(lightNorm), normalize(vertNorm));


	float specularV2 = dot(normalize(reflectionV2),
	normalize(vModel.xyz));
	if (specularV2 <= 0.) { specularV2 = 0.0; }
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  return specularV2;
			  }
			  </textarea>
      <textarea id="shader_decls" rows="20">
	precision mediump float;

	// Vector Attributes
	attribute vec3 vPosA;
	attribute vec3 vNormA;
	attribute vec3 vColA;
	attribute vec2 textureA;

	// Matrixes
	uniform mat4 pMatU; // Position
	uniform mat4 mvnMatU[3]; // Model, View, Normal
	uniform mat4 lMatU; // Lighting

	// Position attributes
	uniform vec3 lightPosU;
	uniform vec3 viewPosU;
	uniform float hi_hat_u;

	// Passed to the fragment shader
	varying vec3 distanceV;
	varying float diffuseV;
	varying vec3 colorV;
	varying vec2 textureV;

	varying vec3 viewPosV;
	varying vec3 vModel;
	varying vec4 lModel;
	varying vec3 lightNorm;
	varying vec3 vertNorm;
      </textarea>
      <textarea id="shader_frag_canvas" rows="20">

	void colorTexture(sampler2D theSampler) {

	float delta = 1.0 / 512.0;
	float sway = sin(frames_elapsed_u / 100.0) / 2.0;
	float sway2 = cos(frames_elapsed_u / 110.0) / 2.0;
	float the_beat = hi_hat_u;

	vec3 textureColor = texture2D(theSampler, textureV).xyz;

	vec3 textureColorz = texture2D(sampler1, vec2(textureV.s, textureV.t)).xyz;
	vec3 reflectionV2 = reflect(normalize(lightNorm), normalize(normalize(vertNorm) +
          normalize(vec3(textureColorz.x, textureColorz.y, textureColorz.z))));
	float diffuseV2 = dot(vertNorm, normalize(lightNorm));

	float specularV2 = dot(normalize(reflectionV2),
        normalize(vModel.xyz));
	if (specularV2 <= 0.0) { specularV2 = 0.0; }
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;

			  vec3 ambColor = textureColor / 3.0;
			  vec3 diffColor = textureColor * diffuseV2 * 0.6;
			  vec3 specColor = textureColor * specularV2;

			  vec3 blendColor = mod(distanceV, 50.0) / 50.0;
			  vec3 normalColor = ambColor + diffColor + specColor;
			  vec3 changedColor = ambColor + diffColor + specColor;

			  changedColor[0] *= sway;
			  changedColor[1] *= -sway2;
			  changedColor[2] *= abs((sway * sway2));

			  float background = clamp(length(changedColor) * 5.0, 0.8, 1.0);

			  vec3 actual_color = changedColor * 1.6;
			  float yellow =  dot(max(vec2(actual_color.r, actual_color.g),0.0), vec2(0.75, 0.75));

			  changedColor = vec3(yellow, yellow, actual_color.b / (yellow + 0.01));


			  gl_FragColor = vec4((changedColor + 2.0 * normalize(changedColor)) / 3.0, background);
			  }

			  void main(void) {
			  colorTexture(sampler0);
			  }
			  </textarea>
      <textarea id="shader_frag_player" rows="20">
	void colorTexture(sampler2D theSampler) {

	float delta = 1.0 / 512.0;
	float sway = sin((frames_elapsed_u + 60.0) / 100.0) / 2.0;
	float sway2 = cos((frames_elapsed_u + 60.0) / 110.0) / 2.0;
	float the_beat = hi_hat_u;

	vec3 textureColor = texture2D(theSampler, textureV).xyz;
	textureColor[0] *= 4.0 * sway;
	textureColor[1] *= -4.0 * sway2;
	textureColor[2] *= abs((sway * sway2));

	float background = clamp(length(textureColor) * 5.0, 0.8, 1.0);

	gl_FragColor = vec4(textureColor * 1.6, 1.0);
	/*	if(background < 0.95 && the_beat > 0.9) gl_FragColor =
	  (20. - the_beat) / 20. * vec4(textureColor * 1.6, background) +
	  the_beat / 20. * texture2D(theSampler, textureV);
	  */	  }

	  void main(void) { colorTexture(sampler1);

	  }
      </textarea>
      <textarea id="shader_frag_default">
	void colorize() {
	vec3 ambColor = colorV / 3.0 * ambient_coeff_u;
	vec3 diffColor = colorV / 3.0 * diffuseV * diffuse_coeff_u;
	vec3 specColor = specular_color_u * specular();
	gl_FragColor = vec4(ambColor + diffColor + specColor, 1.0);
	}

	void colorTexture(sampler2D theSampler) {
	vec3 textureColor = texture2D(theSampler, vec2(textureV.s, textureV.t)).xyz;


	vec3 textureColorz = texture2D(sampler1, vec2(textureV.s, textureV.t)).xyz;
	vec3 reflectionV2 = reflect(normalize(lightNorm), normalize(
          normalize(vertNorm) + normalize(vec3(-textureColorz.x, -textureColorz.y, -textureColorz.z))));
	float diffuseV2 = dot(vertNorm, normalize(lightNorm));

	float specularV2 = dot(normalize(reflectionV2),
        normalize(vModel.xyz));
	if (specularV2 <= 0.0) { specularV2 = 0.0; }
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;
			  specularV2 = specularV2 * specularV2;

			  vec3 ambColor = textureColor / 3.0 * ambient_coeff_u;
			  vec3 diffColor = textureColor * diffuseV2 * 0.7;
			  vec3 specColor = textureColor * specularV2;
			  vec3 blendColor = mod(distanceV, 50.0) / 50.0;
			  vec3 normalColor = ambColor + diffColor + specColor;

			  float wall_hit_coeff = wall_hit_u / 40.0;
			  gl_FragColor = vec4(normalColor + ((ambColor + normalColor) *
			  wall_hit_coeff), 1.0);
			  }


			  void main(void) {
			  //  if(dot(normalize(vertNorm), vec3(0.0, 0.0,-1.0)) < 0.0) {
										 //    discard;
										 colorTexture(sampler0);
										 }
										 </textarea>
      <textarea id="shader_vert_default" rows="20">
	void main(void) {
	// -- Position -- //
	gl_Position = pMatU * mvnMatU[1] * mvnMatU[0] * vec4(vPosA, 1.0);

	// Viewing space coordinates of light / vertex
	vModel = (mvnMatU[1] * mvnMatU[0]  * vec4(vPosA, 1.0)).xyz;
	lModel = mvnMatU[1] * mvnMatU[0] * vec4(lightPosU, 1.0);


	// -- Lighting -- //
	distanceV = lModel.xyz - vModel.xyz;
	lightNorm = normalize(distanceV);
	vertNorm = (mvnMatU[2] * vec4(vNormA,1.0)).xyz;

	// Ambient components we'll leave until frag shader
	colorV = vColA;
	textureV = textureA;
	// Diffuse component
	diffuseV = dot(vertNorm, lightNorm);
	if (diffuseV < 0.0) { diffuseV = 0.0; }

		       }
		       </textarea>
      <textarea id="shader_vert_player" rows="20">
	void main(void) {

	// -- Position -- //
	gl_Position = pMatU * mvnMatU[1] * mvnMatU[0] * vec4(vPosA * (1.0 + (hi_hat_u / 110.0)), 1.0);
	//  gl_Position = pMatU * mvnMatU[1] * mvnMatU[0] * vec4(vPosA, 1.0);

	// Viewing space coordinates of light / vertex
	vModel = (mvnMatU[1] * mvnMatU[0]  * vec4(vPosA, 1.0)).xyz;
	lModel = mvnMatU[1] * lMatU * mvnMatU[0] * vec4(lightPosU, 1.0);


	// -- Lighting -- //
	distanceV = vModel.xyz - lModel.xyz;
	lightNorm = normalize(distanceV);
	vertNorm = (mvnMatU[2] * vec4(vNormA,1.0)).xyz;

	// Ambient components we'll leave until frag shader
	colorV = vColA;
	textureV = textureA;
	// Diffuse component
	diffuseV = dot(vertNorm, lightNorm);
	if (diffuseV < 0.0) { diffuseV = 0.0; }
		       }
		       </textarea>
    </div>

  </body>
</html>
